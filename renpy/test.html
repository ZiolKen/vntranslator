<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>.rpy Translator to Vietnamese</title>
<style>
    body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 800px;
        margin: auto;
        background-color: #f7f7f7;
    }
    textarea {
        width: 100%;
        font-family: monospace;
        font-size: 14px;
        margin-bottom: 10px;
        padding: 10px;
    }
    button {
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        margin-bottom: 20px;
    }
    h1, h2 {
        text-align: center;
    }
</style>
</head>
<body>
<h1>.rpy Translator to Vietnamese</h1>

<textarea id="inputText" placeholder="Paste your .rpy JSON data here..." rows="15"></textarea>
<button id="translateBtn">Translate to Vietnamese</button>

<h2>Translated Result:</h2>
<textarea id="outputText" rows="15" readonly></textarea>

<script>
const translateBtn = document.getElementById('translateBtn');
const inputText = document.getElementById('inputText');
const outputText = document.getElementById('outputText');

// Function to call Lingva translation
async function translateText(text) {
    try {
        const response = await fetch(`https://lingva.ml/api/v1/vi/${encodeURIComponent(text)}`);
        if (!response.ok) throw new Error('Translation failed');
        const data = await response.json();
        return data.translation;
    } catch (err) {
        console.error('Translation error:', err);
        return text; // return original text if error
    }
}

translateBtn.addEventListener('click', async () => {
    let texts;
    try {
        texts = JSON.parse(inputText.value);
    } catch (e) {
        alert("Invalid JSON. Make sure your input is correctly formatted.");
        return;
    }

    outputText.value = "Translating... Please wait.";

    for (let i = 0; i < texts.length; i++) {
        try {
            const dialog = texts[i].dialog;
            // Remove tags like {w=0.7}{nw} before translation
            const tags = dialog.match(/{.*?}/g) || [];
            const cleanText = dialog.replace(/{.*?}/g, '');
            const translated = await translateText(cleanText);
            texts[i].dialog = translated + tags.join('');
        } catch (e) {
            console.error(`Error translating line ${i}:`, e);
        }
    }

    outputText.value = JSON.stringify(texts, null, 4);
});
</script>
</body>
</html>