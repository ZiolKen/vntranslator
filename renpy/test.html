<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>GitHub Uploader</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
        :root{
          --bg:#070811;
          --card:rgba(16,18,32,.62);
          --card2:rgba(10,11,20,.56);
          --stroke:rgba(255,255,255,.10);
          --stroke2:rgba(255,255,255,.14);
          --text:#e9eaf6;
          --muted:rgba(233,234,246,.68);
          --muted2:rgba(233,234,246,.50);
          --good:#19c37d;
          --bad:#ff5c7a;
          --warn:#ffcc66;
          --primary:#7c5cff;
          --shadow:0 18px 70px rgba(0,0,0,.55);
          --shadow2:0 10px 30px rgba(0,0,0,.40);
          --radius:18px;
          --radius2:14px;
        }
        
        *{box-sizing:border-box}
        html,body{height:100%}
        body{
          margin:0;
          font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
          color:var(--text);
          background:radial-gradient(1200px 600px at 20% 10%, rgba(124,92,255,.18), transparent 60%),
                     radial-gradient(1000px 500px at 90% 15%, rgba(25,195,125,.12), transparent 55%),
                     radial-gradient(900px 520px at 60% 100%, rgba(255,92,122,.10), transparent 55%),
                     var(--bg);
          overflow-x:hidden;
        }
        
        .bg{position:fixed;inset:0;pointer-events:none;filter:blur(40px);opacity:.9}
        .orb{position:absolute;border-radius:999px;mix-blend-mode:screen;opacity:.65}
        .o1{width:520px;height:520px;left:-120px;top:-120px;background:radial-gradient(circle at 30% 30%, rgba(124,92,255,.85), rgba(124,92,255,0))}
        .o2{width:540px;height:540px;right:-160px;top:-140px;background:radial-gradient(circle at 35% 35%, rgba(25,195,125,.75), rgba(25,195,125,0))}
        .o3{width:620px;height:620px;left:30%;bottom:-260px;background:radial-gradient(circle at 35% 35%, rgba(255,92,122,.60), rgba(255,92,122,0))}
        
        .wrap{max-width:1100px;margin:0 auto;padding:34px 18px 38px;position:relative}
        .top{display:flex;gap:18px;align-items:flex-start;justify-content:space-between;margin-bottom:18px}
        .brand{display:flex;gap:14px;align-items:flex-start;min-width:0}
        .logo{
          width:44px;height:44px;border-radius:14px;
          background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
          border:1px solid var(--stroke);
          box-shadow:var(--shadow2);
          display:flex;align-items:center;justify-content:center;color:#fff;
        }
        .logo svg{width:22px;height:22px}
        .title{font-weight:700;letter-spacing:-.02em;font-size:22px;line-height:1.1}
        .subtitle{margin-top:6px;color:var(--muted);font-size:13px;line-height:1.35;max-width:640px}
        
        .pill{
          display:flex;align-items:center;gap:14px;
          border:1px solid var(--stroke);
          background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
          border-radius:999px;
          padding:10px 14px;
          box-shadow:var(--shadow2);
        }
        .pillItem{display:flex;flex-direction:column;gap:3px}
        .pillLabel{font-size:11px;color:var(--muted2)}
        .pillValue{font-size:14px;font-weight:600}
        .pillSep{width:1px;height:26px;background:var(--stroke)}
        
        .grid{display:grid;grid-template-columns:1.05fr 1.15fr;gap:16px}
        @media (max-width:980px){.grid{grid-template-columns:1fr}.pill{display:none}}
        
        .card{
          border:1px solid var(--stroke);
          background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.02));
          border-radius:var(--radius);
          box-shadow:var(--shadow);
          overflow:hidden;
        }
        .cardHead{
          display:flex;align-items:center;justify-content:space-between;
          padding:16px 16px 10px;
          border-bottom:1px solid rgba(255,255,255,.06);
        }
        .cardTitle{font-weight:650;font-size:14px;letter-spacing:-.01em}
        .cardHint{font-size:12px;color:var(--muted);margin-top:4px;max-width:560px}
        .rightActions{display:flex;gap:8px;align-items:center}
        
        .form{padding:14px 16px 16px}
        .field{display:block;margin:10px 0}
        .label{display:block;font-size:12px;color:var(--muted);margin-bottom:8px}
        .row{display:flex;gap:10px;align-items:center}
        .cols2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
        @media (max-width:640px){.cols2{grid-template-columns:1fr}}
        .input{
          width:100%;
          border-radius:12px;
          border:1px solid var(--stroke);
          background:rgba(5,6,12,.65);
          color:var(--text);
          padding:11px 12px;
          outline:none;
          font-size:13px;
          transition:border-color .15s ease, transform .15s ease, background .15s ease;
        }
        .input:focus{border-color:rgba(124,92,255,.55);background:rgba(6,7,16,.75)}
        .input::placeholder{color:rgba(233,234,246,.35)}
        
        .actions{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:12px 0 10px}
        @media (max-width:640px){.actions{grid-template-columns:1fr}}
        .hidden{display:none}
        
        .btn{
          border-radius:12px;
          border:1px solid var(--stroke);
          background:rgba(255,255,255,.06);
          color:var(--text);
          padding:10px 12px;
          font-size:13px;
          font-weight:600;
          letter-spacing:-.01em;
          display:inline-flex;
          align-items:center;
          justify-content:center;
          gap:10px;
          cursor:pointer;
          user-select:none;
          transition:transform .10s ease, border-color .15s ease, background .15s ease, opacity .15s ease;
        }
        .btn:active{transform:translateY(1px)}
        .btn:disabled{opacity:.45;cursor:not-allowed}
        .btnIcon{width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center}
        .btnIcon svg{width:18px;height:18px}
        
        .btn.primary{
          background:linear-gradient(180deg, rgba(124,92,255,.92), rgba(124,92,255,.60));
          border-color:rgba(124,92,255,.55);
          box-shadow:0 14px 34px rgba(124,92,255,.18);
        }
        .btn.primary:hover{background:linear-gradient(180deg, rgba(124,92,255,.98), rgba(124,92,255,.62))}
        .btn.primary.full{width:100%}
        .btn.soft{
          background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
        }
        .btn.soft:hover{border-color:rgba(255,255,255,.16)}
        .btn.ghost{
          background:rgba(255,255,255,.02);
        }
        .btn.ghost:hover{border-color:rgba(255,255,255,.16);background:rgba(255,255,255,.04)}
        
        .dropzone{
          margin:10px 0 12px;
          border:1px dashed rgba(255,255,255,.18);
          background:rgba(4,5,10,.45);
          border-radius:var(--radius2);
          padding:14px 14px;
          display:flex;gap:12px;align-items:center;
          cursor:pointer;
          transition:border-color .15s ease, background .15s ease, transform .10s ease;
          outline:none;
        }
        .dropzone:hover{border-color:rgba(124,92,255,.45);background:rgba(5,6,14,.55)}
        .dropzone:active{transform:translateY(1px)}
        .dropzone:focus{border-color:rgba(124,92,255,.55)}
        .dropzone.drag{border-color:rgba(25,195,125,.55);background:rgba(6,18,12,.35)}
        .dzIcon{
          width:40px;height:40px;border-radius:14px;
          border:1px solid var(--stroke);
          background:linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.03));
          display:flex;align-items:center;justify-content:center;
        }
        .dzIcon svg{width:20px;height:20px}
        .dzTitle{font-weight:650;font-size:13px}
        .dzSub{margin-top:3px;font-size:12px;color:var(--muted)}
        
        .status{
          margin-top:12px;
          border-radius:14px;
          border:1px solid var(--stroke);
          background:rgba(5,6,12,.55);
          padding:12px 12px;
        }
        .statusTop{display:flex;align-items:center;justify-content:space-between;gap:10px}
        .statusLabel{font-size:12px;color:var(--muted);min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .statusPct{font-size:12px;color:var(--muted)}
        .bar{margin-top:10px;height:10px;border-radius:999px;background:rgba(255,255,255,.07);overflow:hidden}
        .bar > div{height:100%;width:0%;background:linear-gradient(90deg, rgba(124,92,255,.95), rgba(25,195,125,.75));transition:width .2s ease}
        .statusMsg{margin-top:10px;font-size:12px;color:var(--muted);line-height:1.35}
        .statusOk{border-color:rgba(25,195,125,.35);background:rgba(10,40,26,.28)}
        .statusBad{border-color:rgba(255,92,122,.35);background:rgba(60,10,18,.25)}
        .link{
          display:inline-flex;align-items:center;gap:10px;
          margin-top:10px;
          padding:10px 12px;
          border-radius:12px;
          border:1px solid rgba(255,255,255,.12);
          background:rgba(255,255,255,.04);
          color:var(--text);
          text-decoration:none;
          font-size:13px;
          font-weight:650;
        }
        .link:hover{border-color:rgba(255,255,255,.18);background:rgba(255,255,255,.06)}
        
        .warn{
          padding:12px 16px 0;
          color:rgba(255,204,102,.88);
          font-size:12px;
          line-height:1.35;
        }
        .warn strong{color:rgba(255,204,102,.98)}
        
        .list{padding:14px 16px 16px;min-height:360px}
        .list.empty{display:flex;align-items:center;justify-content:center}
        .emptyState{text-align:center;color:var(--muted)}
        .emptyIcon{
          width:54px;height:54px;margin:0 auto 12px;
          border-radius:18px;border:1px solid var(--stroke);
          background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
          display:flex;align-items:center;justify-content:center;color:rgba(233,234,246,.85);
        }
        .emptyIcon svg{width:26px;height:26px}
        .emptyTitle{font-weight:700;color:rgba(233,234,246,.92);margin-top:2px}
        .emptySub{margin-top:6px;font-size:12px}
        
        .item{
          border:1px solid rgba(255,255,255,.08);
          background:rgba(6,7,14,.45);
          border-radius:14px;
          padding:10px 10px;
          display:flex;align-items:center;gap:10px;
          margin-bottom:10px;
        }
        .itemMain{min-width:0;flex:1}
        .itemPath{font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .itemMeta{margin-top:4px;font-size:12px;color:var(--muted2)}
        .xbtn{
          width:36px;height:36px;border-radius:12px;
          border:1px solid rgba(255,255,255,.10);
          background:rgba(255,255,255,.03);
          color:rgba(233,234,246,.80);
          display:inline-flex;align-items:center;justify-content:center;
          cursor:pointer;
          transition:border-color .15s ease, background .15s ease, transform .10s ease;
        }
        .xbtn:hover{border-color:rgba(255,255,255,.18);background:rgba(255,255,255,.05);color:#fff}
        .xbtn:active{transform:translateY(1px)}
        .xbtn svg{width:18px;height:18px}
        
        .foot{margin-top:14px;padding:6px 2px}
        .footText{font-size:12px;color:var(--muted2)}
    </style>
  </head>
  <body>
    <div class="bg">
      <div class="orb o1"></div>
      <div class="orb o2"></div>
      <div class="orb o3"></div>
    </div>

    <main class="wrap">
      <header class="top">
        <div class="brand">
          <div class="logo" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75 0 4.31 2.794 7.968 6.67 9.258.488.09.668-.212.668-.472 0-.233-.009-.85-.013-1.668-2.713.589-3.285-1.309-3.285-1.309-.443-1.125-1.082-1.424-1.082-1.424-.884-.604.067-.592.067-.592  .978.069 1.493 1.004 1.493 1.004.869 1.488 2.28 1.058 2.836.809.088-.63.34-1.058.618-1.301-2.166-.246-4.444-1.083-4.444-4.82 0-1.064.38-1.934 1.004-2.616-.101-.246-.435-1.238.096-2.58 0 0 .819-.262 2.685 1.0.779-.217 1.616-.326 2.448-.33.832.004 1.67.113 2.45.33 1.865-1.262 2.683-1 2.683-1 .532 1.342.198 2.334.097 2.58.625.682 1.003 1.552 1.003 2.616 0 3.747-2.282 4.571-4.456 4.812.35.302.66.9.66 1.813 0 1.309-.012 2.365-.012 2.687 0 .262.176.566.674.47A9.753 9.753 0 0 0 21.75 12c0-5.385-4.365-9.75-9.75-9.75Z" fill="currentColor"/>
            </svg>
          </div>
          <div>
            <div class="title">GitHub Uploader</div>
            <div class="subtitle">Upload files or folders (with subfolders) to a GitHub repo using a token.</div>
          </div>
        </div>

        <div class="pill">
          <div class="pillItem">
            <span class="pillLabel">Selected</span>
            <span id="selectedCount" class="pillValue">0</span>
          </div>
          <div class="pillSep"></div>
          <div class="pillItem">
            <span class="pillLabel">Total</span>
            <span id="selectedBytes" class="pillValue">0 B</span>
          </div>
        </div>
      </header>

      <section class="grid">
        <div class="card">
          <div class="cardHead">
            <div class="cardTitle">Repository</div>
            <div class="cardHint">Fine-grained token with “Contents: Read & Write” on the target repo.</div>
          </div>

          <div class="form">
            <label class="field">
              <span class="label">GitHub Token</span>
              <div class="row">
                <input id="token" type="password" class="input" placeholder="github_pat_… / ghp_…" autocomplete="off" />
                <button id="toggleToken" class="btn ghost" type="button" aria-label="Toggle token visibility">
                  <span class="btnIcon" aria-hidden="true">
                    <svg viewBox="0 0 24 24" fill="none">
                      <path d="M3 12s3.5-7 9-7 9 7 9 7-3.5 7-9 7-9-7-9-7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </span>
                  Show
                </button>
              </div>
            </label>

            <div class="cols2">
              <label class="field">
                <span class="label">Owner</span>
                <input id="owner" class="input" placeholder="octocat" />
              </label>
              <label class="field">
                <span class="label">Repo</span>
                <input id="repo" class="input" placeholder="my-repo" />
              </label>
            </div>

            <div class="cols2">
              <label class="field">
                <span class="label">Branch (optional)</span>
                <input id="branch" class="input" placeholder="main" />
              </label>
              <label class="field">
                <span class="label">Base path in repo (optional)</span>
                <input id="basePath" class="input" placeholder="uploads/2026" />
              </label>
            </div>

            <label class="field">
              <span class="label">Commit message</span>
              <input id="message" class="input" value="Upload via GitHub Uploader" />
            </label>

            <div class="actions">
              <button id="pickFiles" class="btn soft" type="button">
                <span class="btnIcon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M12 3v12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <path d="M7 8l5-5 5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M5 21h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </span>
                Choose files
              </button>

              <button id="pickFolder" class="btn soft" type="button">
                <span class="btnIcon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M3 7.5A2.5 2.5 0 0 1 5.5 5H10l2 2h6.5A2.5 2.5 0 0 1 21 9.5V18a2.5 2.5 0 0 1-2.5 2.5h-13A2.5 2.5 0 0 1 3 18V7.5Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M12 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <path d="M9.5 13.5 12 11l2.5 2.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
                Choose folder
              </button>

              <input id="filesInput" type="file" multiple class="hidden" />
              <input id="folderInput" type="file" multiple class="hidden" />
            </div>

            <div id="dropzone" class="dropzone" tabindex="0" role="button" aria-label="Drop files here or click to choose files">
              <div class="dzIcon" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M12 3v10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M7 8l5-5 5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M5 21h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </div>
              <div class="dzText">
                <div class="dzTitle">Drag & drop files here</div>
                <div class="dzSub">or click to pick files. Folder picker works best on Chrome/Edge.</div>
              </div>
            </div>

            <button id="uploadBtn" class="btn primary full" type="button" disabled>
              <span class="btnIcon" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M12 3v12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M7 8l5-5 5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M5 21h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </span>
              Upload & Commit
            </button>

            <div id="status" class="status hidden"></div>
          </div>
        </div>

        <div class="card">
          <div class="cardHead">
            <div class="cardTitle">Files</div>
            <div class="rightActions">
              <button id="clearBtn" class="btn ghost" type="button" disabled>Clear</button>
            </div>
          </div>

          <div id="warnings" class="warn hidden"></div>

          <div id="fileList" class="list empty">
            <div class="emptyState">
              <div class="emptyIcon" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M4 17.5V6.5A2.5 2.5 0 0 1 6.5 4H14l6 6v7.5A2.5 2.5 0 0 1 17.5 20h-11A2.5 2.5 0 0 1 4 17.5Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                  <path d="M14 4v6h6" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="emptyTitle">No files selected</div>
              <div class="emptySub">Choose files or a folder to begin.</div>
            </div>
          </div>
        </div>
      </section>

      <footer class="foot">
        <div class="footText">
          This uploads directly from your browser to GitHub. Use a dedicated token and avoid using this on shared machines.
        </div>
      </footer>
    </main>
    <script>
        const el = (id) => document.getElementById(id)
        
        const ui = {
          token: el("token"),
          toggleToken: el("toggleToken"),
          owner: el("owner"),
          repo: el("repo"),
          branch: el("branch"),
          basePath: el("basePath"),
          message: el("message"),
          pickFiles: el("pickFiles"),
          pickFolder: el("pickFolder"),
          filesInput: el("filesInput"),
          folderInput: el("folderInput"),
          uploadBtn: el("uploadBtn"),
          clearBtn: el("clearBtn"),
          dropzone: el("dropzone"),
          fileList: el("fileList"),
          warnings: el("warnings"),
          status: el("status"),
          selectedCount: el("selectedCount"),
          selectedBytes: el("selectedBytes")
        }
        
        ui.filesInput.accept = "*/*"
        ui.folderInput.accept = "*/*"
        ui.folderInput.setAttribute("webkitdirectory", "")
        ui.folderInput.setAttribute("directory", "")
        
        let tokenVisible = false
        let busy = false
        let selected = new Map()
        
        function normalizeRepoPath(input) {
          const raw = String(input || "").replace(/\\/g, "/").trim()
          const parts = raw.split("/").filter(Boolean)
          const safe = []
          for (const p of parts) {
            if (p === "." || p === "..") continue
            safe.push(p.replace(/\u0000/g, ""))
          }
          return safe.join("/")
        }
        
        function joinRepoPath(a, b) {
          const left = normalizeRepoPath(a)
          const right = normalizeRepoPath(b)
          if (!left) return right
          if (!right) return left
          return left + "/" + right
        }
        
        function formatBytes(bytes) {
          const units = ["B", "KB", "MB", "GB"]
          let v = bytes
          let i = 0
          while (v >= 1024 && i < units.length - 1) {
            v /= 1024
            i++
          }
          return `${v.toFixed(i === 0 ? 0 : 2)} ${units[i]}`
        }
        
        function fileRelPath(file) {
          const rel = file.webkitRelativePath ? String(file.webkitRelativePath) : ""
          return normalizeRepoPath(rel || file.name)
        }
        
        function addFiles(fileList) {
          const arr = Array.from(fileList || [])
          for (const f of arr) {
            const path = fileRelPath(f)
            if (!path) continue
            selected.set(path, f)
          }
          render()
        }
        
        function clearFiles() {
          selected = new Map()
          render()
        }
        
        function removeFile(path) {
          selected.delete(path)
          render()
        }
        
        function computeTotals() {
          let bytes = 0
          for (const f of selected.values()) bytes += f.size || 0
          return { count: selected.size, bytes }
        }
        
        function setWarnings() {
          const items = Array.from(selected.entries())
          const tooBig = items.filter(([, f]) => (f.size || 0) > 100 * 1024 * 1024)
          const big = items.filter(([, f]) => (f.size || 0) > 25 * 1024 * 1024 && (f.size || 0) <= 100 * 1024 * 1024)
          const many = items.length >= 200
        
          const lines = []
          if (tooBig.length) lines.push(`<strong>${tooBig.length}</strong> file(s) exceed 100 MB and will likely fail on GitHub API uploads.`)
          if (big.length) lines.push(`<strong>${big.length}</strong> file(s) are above 25 MB. Uploading may be slow or fail depending on GitHub constraints.`)
          if (many) lines.push(`You selected <strong>${items.length}</strong> files. This will send many API requests and may hit rate limits.`)
        
          if (lines.length) {
            ui.warnings.innerHTML = lines.map((x) => `<div>${x}</div>`).join("")
            ui.warnings.classList.remove("hidden")
          } else {
            ui.warnings.classList.add("hidden")
            ui.warnings.innerHTML = ""
          }
        }
        
        function updateButtons() {
          const hasRepo = ui.owner.value.trim() && ui.repo.value.trim()
          const can = !busy && ui.token.value.trim() && hasRepo && selected.size > 0
          ui.uploadBtn.disabled = !can
          ui.clearBtn.disabled = busy || selected.size === 0
          ui.pickFiles.disabled = busy
          ui.pickFolder.disabled = busy
          ui.toggleToken.disabled = busy
        }
        
        function renderList() {
          const items = Array.from(selected.entries()).sort((a, b) => a[0].localeCompare(b[0]))
          if (!items.length) {
            ui.fileList.className = "list empty"
            ui.fileList.innerHTML = `
              <div class="emptyState">
                <div class="emptyIcon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M4 17.5V6.5A2.5 2.5 0 0 1 6.5 4H14l6 6v7.5A2.5 2.5 0 0 1 17.5 20h-11A2.5 2.5 0 0 1 4 17.5Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M14 4v6h6" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                  </svg>
                </div>
                <div class="emptyTitle">No files selected</div>
                <div class="emptySub">Choose files or a folder to begin.</div>
              </div>
            `
            return
          }
        
          ui.fileList.className = "list"
          ui.fileList.innerHTML = items
            .map(([path, f]) => {
              const base = normalizeRepoPath(ui.basePath.value)
              const finalPath = joinRepoPath(base, path)
              return `
                <div class="item">
                  <div class="itemMain">
                    <div class="itemPath" title="${escapeHtml(finalPath)}">${escapeHtml(finalPath)}</div>
                    <div class="itemMeta">${escapeHtml(formatBytes(f.size || 0))}</div>
                  </div>
                  <button class="xbtn" type="button" data-remove="${escapeHtml(path)}" aria-label="Remove">
                    <svg viewBox="0 0 24 24" fill="none">
                      <path d="M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                      <path d="M18 6 6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                  </button>
                </div>
              `
            })
            .join("")
        
          for (const btn of ui.fileList.querySelectorAll("[data-remove]")) {
            btn.addEventListener("click", () => removeFile(btn.getAttribute("data-remove")))
          }
        }
        
        function renderTop() {
          const { count, bytes } = computeTotals()
          ui.selectedCount.textContent = String(count)
          ui.selectedBytes.textContent = formatBytes(bytes)
        }
        
        function render() {
          setWarnings()
          renderTop()
          renderList()
          updateButtons()
        }
        
        function escapeHtml(s) {
          return String(s)
            .replaceAll("&", "&amp;")
            .replaceAll("<", "&lt;")
            .replaceAll(">", "&gt;")
            .replaceAll('"', "&quot;")
            .replaceAll("'", "&#039;")
        }
        
        function setStatus({ variant, label, pct, message, link }) {
          ui.status.className = "status"
          ui.status.innerHTML = `
            <div class="statusTop">
              <div class="statusLabel" title="${escapeHtml(label)}">${escapeHtml(label)}</div>
              <div class="statusPct">${escapeHtml(String(pct))}%</div>
            </div>
            <div class="bar"><div style="width:${Math.max(0, Math.min(100, pct))}%"></div></div>
            ${message ? `<div class="statusMsg">${message}</div>` : ""}
            ${link ? `<a class="link" href="${link}" target="_blank" rel="noreferrer">Open commit on GitHub</a>` : ""}
          `
          if (variant === "ok") ui.status.classList.add("statusOk")
          if (variant === "bad") ui.status.classList.add("statusBad")
          ui.status.classList.remove("hidden")
        }
        
        function hideStatus() {
          ui.status.classList.add("hidden")
          ui.status.innerHTML = ""
        }
        
        async function fileToBase64(file) {
          const dataUrl = await new Promise((resolve, reject) => {
            const r = new FileReader()
            r.onerror = () => reject(new Error("Failed to read file"))
            r.onload = () => resolve(String(r.result || ""))
            r.readAsDataURL(file)
          })
          const idx = dataUrl.indexOf(",")
          if (idx < 0) throw new Error("Invalid file encoding")
          return dataUrl.slice(idx + 1)
        }
        
        async function request(token, path, init) {
          const res = await fetch("https://api.github.com" + path, {
            ...init,
            headers: {
              Accept: "application/vnd.github+json",
              "X-GitHub-Api-Version": "2022-11-28",
              Authorization: `Bearer ${token}`,
              ...(init && init.headers ? init.headers : {})
            },
            cache: "no-store"
          })
          if (res.ok) return await res.json()
          let msg = `GitHub API error (${res.status})`
          try {
            const j = await res.json()
            if (j && j.message) msg = j.message
          } catch {}
          throw new Error(msg)
        }
        
        async function getDefaultBranch(token, owner, repo) {
          const info = await request(token, `/repos/${encodeURIComponent(owner)}/${encodeURIComponent(repo)}`)
          return info.default_branch
        }
        
        async function tryGetHeadSha(token, owner, repo, branch) {
          try {
            const ref = await request(
              token,
              `/repos/${encodeURIComponent(owner)}/${encodeURIComponent(repo)}/git/ref/heads/${encodeURIComponent(branch)}`
            )
            return ref.object.sha
          } catch (e) {
            const m = String(e && e.message ? e.message : "")
            if (m.toLowerCase().includes("not found")) return null
            throw e
          }
        }
        
        async function getCommit(token, owner, repo, sha) {
          return await request(
            token,
            `/repos/${encodeURIComponent(owner)}/${encodeURIComponent(repo)}/git/commits/${encodeURIComponent(sha)}`
          )
        }
        
        async function createBlob(token, owner, repo, base64) {
          return await request(token, `/repos/${encodeURIComponent(owner)}/${encodeURIComponent(repo)}/git/blobs`, {
            method: "POST",
            body: JSON.stringify({ content: base64, encoding: "base64" })
          })
        }
        
        async function createTree(token, owner, repo, baseTreeSha, items) {
          const tree = items.map((i) => ({ path: i.path, mode: "100644", type: "blob", sha: i.sha }))
          const body = baseTreeSha ? { base_tree: baseTreeSha, tree } : { tree }
          return await request(token, `/repos/${encodeURIComponent(owner)}/${encodeURIComponent(repo)}/git/trees`, {
            method: "POST",
            body: JSON.stringify(body)
          })
        }
        
        async function createCommit(token, owner, repo, message, treeSha, parentSha) {
          const body = parentSha ? { message, tree: treeSha, parents: [parentSha] } : { message, tree: treeSha, parents: [] }
          return await request(token, `/repos/${encodeURIComponent(owner)}/${encodeURIComponent(repo)}/git/commits`, {
            method: "POST",
            body: JSON.stringify(body)
          })
        }
        
        async function updateRef(token, owner, repo, branch, sha) {
          return await request(
            token,
            `/repos/${encodeURIComponent(owner)}/${encodeURIComponent(repo)}/git/refs/heads/${encodeURIComponent(branch)}`,
            { method: "PATCH", body: JSON.stringify({ sha, force: false }) }
          )
        }
        
        async function createRef(token, owner, repo, branch, sha) {
          return await request(token, `/repos/${encodeURIComponent(owner)}/${encodeURIComponent(repo)}/git/refs`, {
            method: "POST",
            body: JSON.stringify({ ref: `refs/heads/${branch}`, sha })
          })
        }
        
        async function asyncPool(limit, array, iterator) {
          const ret = []
          const executing = []
          for (const item of array) {
            const p = Promise.resolve().then(() => iterator(item))
            ret.push(p)
            if (limit <= array.length) {
              const e = p.then(() => executing.splice(executing.indexOf(e), 1))
              executing.push(e)
              if (executing.length >= limit) await Promise.race(executing)
            }
          }
          return Promise.all(ret)
        }
        
        async function upload() {
          const token = ui.token.value.trim()
          const owner = ui.owner.value.trim()
          const repo = ui.repo.value.trim()
          const msg = ui.message.value.trim() || "Upload via GitHub Uploader"
          let branch = ui.branch.value.trim()
          const base = normalizeRepoPath(ui.basePath.value)
        
          if (!token || !owner || !repo || selected.size === 0) return
        
          busy = true
          render()
          hideStatus()
        
          const files = Array.from(selected.entries())
            .map(([path, file]) => ({ path: joinRepoPath(base, path), file }))
            .sort((a, b) => a.path.localeCompare(b.path))
        
          try {
            if (!branch) branch = await getDefaultBranch(token, owner, repo)
        
            setStatus({ variant: "info", label: `Preparing (${files.length} files)`, pct: 5, message: "" })
        
            const headSha = await tryGetHeadSha(token, owner, repo, branch)
            let baseTreeSha = null
            if (headSha) {
              const headCommit = await getCommit(token, owner, repo, headSha)
              baseTreeSha = headCommit.tree.sha
            }
        
            const maxPct = 80
            let done = 0
        
            const makeBlob = async ({ path, file }) => {
              const b64 = await fileToBase64(file)
              const blob = await createBlob(token, owner, repo, b64)
              done += 1
              const pct = 10 + Math.round((done / files.length) * maxPct)
              setStatus({
                variant: "info",
                label: `Uploading (${done}/${files.length}) ${path}`,
                pct,
                message: ""
              })
              return { path, sha: blob.sha }
            }
        
            const blobItems = await asyncPool(3, files, makeBlob)
        
            setStatus({ variant: "info", label: "Building tree", pct: 92, message: "" })
            const tree = await createTree(token, owner, repo, baseTreeSha, blobItems)
        
            setStatus({ variant: "info", label: "Creating commit", pct: 96, message: "" })
            const commit = await createCommit(token, owner, repo, msg, tree.sha, headSha)
        
            setStatus({ variant: "info", label: "Updating branch", pct: 98, message: "" })
            if (headSha) await updateRef(token, owner, repo, branch, commit.sha)
            else await createRef(token, owner, repo, branch, commit.sha)
        
            const link = `https://github.com/${owner}/${repo}/commit/${commit.sha}`
            setStatus({
              variant: "ok",
              label: "Done",
              pct: 100,
              message: `Commit SHA: <span style="font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace">${escapeHtml(commit.sha)}</span>`,
              link
            })
          } catch (e) {
            setStatus({
              variant: "bad",
              label: "Upload failed",
              pct: 100,
              message: escapeHtml(String(e && e.message ? e.message : "Unknown error"))
            })
          } finally {
            busy = false
            render()
          }
        }
        
        ui.toggleToken.addEventListener("click", () => {
          tokenVisible = !tokenVisible
          ui.token.type = tokenVisible ? "text" : "password"
          ui.toggleToken.lastChild.textContent = tokenVisible ? "Hide" : "Show"
        })
        
        ui.pickFiles.addEventListener("click", () => ui.filesInput.click())
        ui.pickFolder.addEventListener("click", () => ui.folderInput.click())
        ui.filesInput.addEventListener("change", (e) => e.target.files && addFiles(e.target.files))
        ui.folderInput.addEventListener("change", (e) => e.target.files && addFiles(e.target.files))
        
        ui.clearBtn.addEventListener("click", clearFiles)
        ui.uploadBtn.addEventListener("click", upload)
        
        for (const input of [ui.token, ui.owner, ui.repo, ui.branch, ui.basePath, ui.message]) {
          input.addEventListener("input", () => render())
        }
        
        ui.dropzone.addEventListener("click", () => ui.filesInput.click())
        ui.dropzone.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") ui.filesInput.click()
        })
        
        ui.dropzone.addEventListener("dragenter", (e) => {
          e.preventDefault()
          ui.dropzone.classList.add("drag")
        })
        ui.dropzone.addEventListener("dragover", (e) => {
          e.preventDefault()
          ui.dropzone.classList.add("drag")
        })
        ui.dropzone.addEventListener("dragleave", () => ui.dropzone.classList.remove("drag"))
        ui.dropzone.addEventListener("drop", (e) => {
          e.preventDefault()
          ui.dropzone.classList.remove("drag")
          const dt = e.dataTransfer
          if (dt && dt.files && dt.files.length) addFiles(dt.files)
        })
        
        render()
    </script>
  </body>
</html>