<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pro Ren'Py Translator | VN Translator</title>
  <link rel="stylesheet" href="./prenpy.css" />
</head>
<body>
  <div id="app">
    <header class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="brand-text">
          <div class="brand-title">VN Translator</div>
          <div class="brand-sub">Pro Ren'Py Translator</div>
        </div>
      </div>

      <div class="topbar-actions">
        <button class="btn" id="btnOpen">Open .rpy</button>
        <button class="btn" id="btnOpenFolder">Open Folder</button>
        <button class="btn" id="btnImportTranslated">Import Translated</button>
        <div class="sep"></div>

        <div class="field compact">
          <label for="modeSelect">Extract</label>
          <select id="modeSelect">
            <option value="safe" selected>Safe</option>
            <option value="balanced">Balanced</option>
            <option value="aggressive">Aggressive</option>
          </select>
        </div>

        <div class="field compact">
          <label for="engineSelect">Engine</label>
          <select id="engineSelect">
            <option value="deepseek" selected>DeepSeek</option>
            <option value="deepl">DeepL</option>
            <option value="lingva">Lingva</option>
          </select>
        </div>

        <div class="field compact">
          <label for="targetLang">Target</label>
          <select id="targetLang"></select>
        </div>

        <button class="btn ghost" id="btnSettings">Settings</button>
        <button class="btn primary" id="btnTranslate">Translate</button>
        <button class="btn" id="btnExport">Export</button>
      </div>
    </header>

    <main class="main">
      <aside class="sidebar">
        <div class="sidebar-head">
          <div class="sidebar-title">Files</div>
          <div class="sidebar-actions">
            <button class="iconbtn" id="btnCloseFile" title="Close file" aria-label="Close file">×</button>
          </div>
        </div>

        <div class="filelist" id="fileList" role="listbox" aria-label="Project files"></div>

        <div class="sidebar-foot">
          <div class="stat">
            <div class="stat-label">Total</div>
            <div class="stat-value" id="statTotal">0</div>
          </div>
          <div class="stat">
            <div class="stat-label">Translated</div>
            <div class="stat-value" id="statDone">0</div>
          </div>
          <div class="stat">
            <div class="stat-label">Progress</div>
            <div class="stat-value" id="statPct">0%</div>
          </div>
        </div>
      </aside>

      <section class="work">
        <div class="work-toolbar">
          <div class="field grow">
            <input id="searchBox" type="search" placeholder="Search (original or translation)..." autocomplete="off" />
          </div>

          <div class="toggle">
            <input type="checkbox" id="onlyUntranslated" />
            <label for="onlyUntranslated">Untranslated</label>
          </div>

          <div class="toggle">
            <input type="checkbox" id="onlyWarnings" />
            <label for="onlyWarnings">Warnings</label>
          </div>

          <div class="toggle">
            <input type="checkbox" id="caseSensitive" />
            <label for="caseSensitive">Aa</label>
          </div>

          <div class="sep"></div>
          <button class="btn" id="btnTranslateSelected">Translate Selected</button>
          <button class="btn" id="btnCopyMt">MT → Manual</button>
        </div>

        <div class="split">
          <div class="pane left">
            <div class="table-head">
              <div class="th idx">#</div>
              <div class="th col">Original</div>
              <div class="th col">Manual</div>
              <div class="th tiny">!</div>
            </div>
            <div class="table-body" id="tableBody"></div>
          </div>

          <div class="pane right">
            <div class="editor">
              <div class="editor-head">
                <div class="editor-title" id="editorTitle">No selection</div>
                <div class="editor-actions">
                  <button class="btn small" id="btnPrev">Prev</button>
                  <button class="btn small" id="btnNext">Next</button>
                </div>
              </div>

              <div class="editor-section">
                <div class="labelrow">
                  <div class="label">Original (read-only)</div>
                  <button class="btn small ghost" id="btnInsertTags">Insert Tags</button>
                </div>
                <textarea id="editorOriginal" readonly></textarea>
              </div>

              <div class="editor-section">
                <div class="labelrow">
                  <div class="label">Machine Translation</div>
                  <button class="btn small" id="btnUseMt">Use as Manual</button>
                </div>
                <textarea id="editorMt" readonly></textarea>
              </div>

              <div class="editor-section grow">
                <div class="labelrow">
                  <div class="label">Manual Translation (placeholders protected)</div>
                  <div class="chip" id="placeholderHint">Keep ⟦RENPH{n}⟧ tokens intact</div>
                </div>
                <textarea id="editorManual" spellcheck="false"></textarea>
              </div>

              <div class="editor-foot">
                <div class="hint" id="validationHint"></div>
                <div class="editor-foot-actions">
                  <button class="btn" id="btnSaveRow">Save</button>
                  <button class="btn ghost" id="btnClearRow">Clear</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="logs">
          <div class="logs-head">
            <div class="logs-title">Logs</div>
            <div class="logs-actions">
              <button class="btn small ghost" id="btnClearLogs">Clear</button>
            </div>
          </div>
          <div class="logs-body" id="logBody" aria-live="polite"></div>
        </div>
      </section>
    </main>
  </div>

  <input id="fileInput" type="file" accept=".rpy,.txt" multiple hidden />
  <input id="fileInputTranslated" type="file" accept=".rpy,.txt" multiple hidden />

  <div id="modalRoot"></div>
  <div id="toastRoot"></div>

  <script type="module" src="./src/app.js"></script>
</body>
</html>
