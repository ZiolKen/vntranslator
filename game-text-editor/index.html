<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta content="ie=edge" http-equiv="X-UA-Compatible" />
  <meta name="theme-color" content="#0b0b10" />

  <title>Game Text Editor | VN Translator</title>

  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <link href="./Content/custom.css" rel="stylesheet" />
  <link href="./Content/style.css" rel="stylesheet" />
  <link href="./Content/jquery.fileupload.css" rel="stylesheet" />

  <link href="./Content/pro.css" rel="stylesheet" />

  <style>
    .qnavi{
      position: fixed;
      right: 20px;
      bottom: 20px;
      z-index: 150;
      opacity: 0.35;
    }
    .qnavi:hover{opacity:1}
    .hl{color:black}
  </style>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BXTNE3VPWH"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-BXTNE3VPWH');
  </script>
</head>

<body>
  <div class="bg" aria-hidden="true">
    <div id="particles-js"></div>
    <div class="grid"></div>
    <div class="glow"></div>
  </div>

  <header class="topbar">
    <a class="brand" href="../">
      <span aria-hidden="true">
        <img class="brand__img" src="https://files.catbox.moe/2x5vw3.jpeg" alt="VN Translator" />
      </span>
      <span class="brand__text">
        <span class="brand__name">VN Translator</span>
        <span class="brand__tag">Ren‚ÄôPy ‚Ä¢ RPG Maker ‚Ä¢ Text Tools</span>
      </span>
    </a>

    <nav class="nav">
      <a class="nav__link" href="../renpy/">Ren‚ÄôPy</a>
      <a class="nav__link" href="../rpgm/">RPG Maker</a>
      <a class="nav__link nav__link--active" href="./">Game Text Editor</a>
      <a class="nav__link nav__link--muted" href="../rpgmu/">RPGM Ultimate</a>
    </nav>

    <div class="topbar__actions">
      <a class="pill pill--primary" href="../">Back</a>
    </div>
  </header>

  <main class="wrap">
    <section class="pageHead">
      <div class="pageHead__left">
        <div class="badge">
          <span class="dot" aria-hidden="true"></span>
          Game Text Editor
        </div>

        <h1 class="title">
          Edit & translate game text with <span class="accent">Monaco Editor</span>.
        </h1>

        <p class="subtitle">
          Drag & drop files, edit safely, rename characters, and export. Supports common VN/game formats.
        </p>

        <div class="quickActions">
          <a class="btn btn--ghost" href="../renpy/" title="Ren'Py Translator">üéÆ Ren‚ÄôPy Translator</a>
          <a class="btn btn--ghost" href="../rpgm/" title="RPG Maker Translator">üïπÔ∏è RPG Maker Translator</a>
        </div>
      </div>

      <div class="pageHead__right">
        <div class="miniPanel">
          <div class="miniPanel__row">
            <div class="miniPanel__k">Supported</div>
            <div class="miniPanel__v"><span class="chip chip--ok">JSON</span> MV/MZ, <span class="chip">RPY</span>, <span class="chip">KS</span></div>
          </div>
          <div class="miniPanel__row">
            <div class="miniPanel__k">Data privacy</div>
            <div class="miniPanel__v">Uploads auto-deleted after 1 day</div>
          </div>
          <div class="miniPanel__row">
            <div class="miniPanel__k">Safety</div>
            <div class="miniPanel__v">Make backups before saving</div>
          </div>
        </div>
      </div>
    </section>

    <section class="layout editorLayout">
      <div class="col">
        <section class="panel">
          <div class="panel__header">
            <div>
              <div class="panel__title">Quick Notes</div>
              <div class="panel__hint">What to upload & where to find files</div>
            </div>
          </div>
          <div class="panel__body notice">
            <ul class="notice-list">
              <li>RPG Maker MV/MZ: edit <b>*.json</b> in <code>\www\data</code></li>
              <li>Ren‚ÄôPy: edit <b>*.rpy</b> (extract RPA / decompile RPYC if needed)</li>
              <li>Kirikiri / Tyranobuild: edit <b>*.ks</b> (extract game data first)</li>
              <li>All uploaded data is deleted after <b>1 day</b>. Still: <b>make backups</b>.</li>
            </ul>
          </div>
        </section>

        <section class="panel">
          <div class="panel__header">
            <div>
              <div class="panel__title">Upload files</div>
              <div class="panel__hint">Drag & drop or click to browse</div>
            </div>
          </div>

          <div class="panel__body">
            <div id="dropZone" class="dropzone" role="button" tabindex="0">
              <div class="dropzone__icon">üìÅ</div>
              <div class="dropzone__title">DROP YOUR FILE HERE</div>
              <div class="dropzone__sub">or <u>click to choose</u> (JSON / RPY / KS)</div>
            </div>
            <input id="fileupload" type="file" multiple name="files" class="fileinput">
          </div>
        </section>

        <section class="panel">
          <div class="panel__header">
            <div>
              <div class="panel__title">Support</div>
              <div class="panel__hint">Help keep the project alive</div>
            </div>
          </div>

          <div class="panel__body">
            <div class="support">
              <div class="support__label">Support this project</div>
              <div class="support__buttons">
                <a class="supportBtn" href="https://www.buymeacoffee.com/_zkn" target="_blank" rel="noopener">‚òï Buy me a coffee</a>
                <a class="supportBtn supportBtn--patreon" href="https://www.patreon.com/ZiolKen" target="_blank" rel="noopener">‚ù§Ô∏è Patreon</a>
              </div>
            </div>
          </div>
        </section>

        <div class="backRow">
          <a href="../" class="backBtn">‚¨ÖÔ∏è Back to Main Menu</a>
        </div>
      </div>

      <div class="col">
        <section class="panel panel--editor">
          <div class="panel__header">
            <div>
              <div class="panel__title">Monaco Editor</div>
              <div class="panel__hint">Tabs ‚Ä¢ Status bar ‚Ä¢ Fast search</div>
            </div>
          </div>

          <div class="panel__body">
            <div class="wrapeditor">
              <div id="tabBar" class="tab-bar"></div>
              <div id="editorContainer" class="editor-area"></div>

              <div id="statusBar" class="status-bar">
                <div id="cursorPos">Ln 1, Col 1</div>
                <div id="indentInfo">Spaces: 4</div>
                <div id="encodingInfo">UTF-8</div>
                <div id="eolInfo">CRLF</div>
                <div id="langInfo">PLAINTEXT</div>
              </div>
            </div>

            <div id="buttonBar" class="button-bar"></div>
          </div>
        </section>

        <div class="footer-note">
          ‚ö†Ô∏è By using this tool, you agree to accept all kinds of risks.
        </div>
      </div>
    </section>
  </main>

  <div id="PreLoad" style="font-size: 50px; position: fixed; display: flex; z-index: 999999; padding: 270px 40px; font-weight: bold; font-family: 'Turret Road', sans-serif; inset: 0; transition: opacity 0.6s ease; backdrop-filter: blur(3px); justify-content: center; align-items: center; text-align: center; background-color: rgba(0, 0, 0, 0.6); color: white; display: none;">Loading...</div>

  <script src="./bundles/custom.js"></script>
  <script src="./bundles/script.js"></script>
  <script>
  		function getFormData($form){
  			var unindexed_array = $form.serializeArray();
  			var indexed_array = {};
  			$.map(unindexed_array, function (n, i) {
  				if (!(n['name'] in indexed_array))
  					indexed_array[n['name']] = n['value'];
  			});
  			return indexed_array;
  		}
  
  		function PreLoadOn() {
  			$('#PreLoad').show();
  		}
  		function PreLoadOff() {
  			$('#PreLoad').hide();
  		}
  	
      document.addEventListener("keydown", e => {
        if (
          e.key === "F12" ||
          (e.ctrlKey && e.shiftKey && ["I", "J", "C"].includes(e.key)) ||
          (e.ctrlKey && e.key === "U")
        ) {
          e.preventDefault();
        }
      });
      console.log('%c‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ïó\n‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë\n‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë\n‚ñë‚ïö‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïù‚ñë‚ïö‚ïê‚ïù\n‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïó\n‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ñë‚ñë‚ñë‚ñë‚ïö‚ïê‚ïù‚ñë‚ñë‚ñë‚ñë‚ïö‚ïê‚ïê‚ïê‚ïê‚ïù‚ñë‚ïö‚ïê‚ïù‚ñë‚ñë‚ñë‚ñë‚ñë‚ïö‚ïê‚ïù', 'color: red; font-weight: bold;');
  </script>
  <script src="./bundles/index.js"></script>
  <script src="./Scripts/particles.js"></script>
  <script>
  const API_HOSTS = [
    "https://game-text-editor-api-production.up.railway.app",
    "https://game-text-editor-api-production-aeba.up.railway.app",
    "https://game-text-editor-api-production-7a01.up.railway.app",
    "https://game-text-backend.onrender.com",
    "https://game-text-editor.onrender.com",
    "https://game-text-editor-api-9grm.onrender.com",
    "https://game-text-backend-backup-u9d9.onrender.com",
    "https://game-text-backend.vercel.app",
    "https://game-text-editor.vercel.app",
    "https://game-text-editor-api.vercel.app",
    "https://game-text-backend-backup.vercel.app"
  ];
  
  async function apiFetch(path, options) {
    for (let base of API_HOSTS) {
      try {
        const res = await fetch(base + path, options);
        if (res.ok) {
          console.log("Using API:", base);
          return res;
        }
      } catch (e) {
        console.warn("API failed:", base);
      }
    } catch (e) {
      console.error(e);
      alert("‚ùå All backend servers failed!");
      PreLoadOff();
    }
  }
  	
  async function loadEditor(id) {
      PreLoadOn();
      try {
          const res = await apiFetch("/Edit/" + id);
          if (!res.ok) {
              alert("Load editor error: " + res.status);
              PreLoadOff();
              return;
          }
          const json = await res.json();
          $('#headM').show();
          $('#editorContainer').show();
          renderEditor(json);
      } catch (e) {
          console.error(e);
          alert("Editor load failed");
      }
      PreLoadOff();
  }
  	
  async function saveData(id) {
      let dataText = document.getElementById("editorArea").value;
      let json;
      try {
          json = JSON.parse(dataText);
      } catch (e) {
          alert("Invalid JSON!");
          return;
      }
      PreLoadOn();
      try {
          const res = await apiFetch("/Edit/" + id, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ data: json })
          });
          if (res.ok) {
              const blob = await res.blob();
              const url = URL.createObjectURL(blob);
              const a = document.createElement("a");
              a.href = url;
              a.download = "edited.json";
              a.click();
              URL.revokeObjectURL(url);
          } else {
              alert("Save failed: " + res.status);
          }
      } catch (err) {
          console.error(err);
          alert("Save network error!");
      }
      PreLoadOff();
  }
  </script>
  <script src="./Scripts/filedrop.js"></script>
  <script src="./Scripts/editor.js"></script>
</body>

</html>