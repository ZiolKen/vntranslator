<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="ie=edge" http-equiv="X-UA-Compatible">
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <meta name="theme-color" content="#000000">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <title>Game Text Editor</title>
    <link href="./Content/custom.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Turret+Road:wght@400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link href="./Content/style.css" rel="stylesheet" />
    <link href="./Content/jquery.fileupload.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js"></script>
 
	<style>
		.qnavi {
			position: fixed;
			right: 20px;
			bottom: 20px;
			z-index: 150;
			opacity: 0.3;
		}

		.qnavi:hover {
			opacity: 1;
		}

		.hl {
			color: black;
		}
	</style>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BXTNE3VPWH"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-BXTNE3VPWH');
    </script>
</head>

<body>
<div id="particles-js"></div>
<div class="grid-bg"></div>
	
<h1 id="main-title" class="floating" style="font-size: 3rem; font-weight: 900; margin-bottom: 1rem; animation: floating 3s ease-in-out infinite; color: #fff; text-shadow: 0 0 10px #ff00ff, 0 0 20px #ff00ff;">
    Game Text <span style="background: linear-gradient(to right, #c084fc, #f472b6, #c084fc); -webkit-background-clip: text; color: transparent; background-clip: text;">Editor</span>
</h1>

<div class="container body-content">

<div class="card usage-tips" id="head">
	<p style="font-size: 1.1rem;" itemprop="description">
		This tool can extract and update texts of game in most easy way. For editing, translating, or you can rename any character. Just drag your üìÅ <b>File</b> to the site.
		<br />Translate games before playing, it's easy.
	</p>
	<ul class="notice-list">
		<li>Editor for RPG Maker MV, MZ. *.json</li>
		<li>Editor for Ren'Py *.rpy</li>
		<li>Editor for Kirikiri *.ks</li>
		<li>Editor for Tyranobuild *.ks</li>
		<li>For MV, MZ the <b>data</b> have be here \www\data</li>
		<li>For Ren'Py you need extract RPA/decompile RPYC if necessary.</li>
		<li>For Kirikiri/Tyranobuild you need extract game data with some tool.</li>
		<li>All data submitted/uploaded is deleted after 1 day.</li>
		<li>Be careful, make backups.</li>
	</ul>
</div>

<div id="headM" style="display: none;"><br /></div>

<div id="dropZone" style="margin-top: 35px; margin-block: 35px;">
    üìÇ <b>DROP YOUR FILE HERE</b><br>
    or <u>click to choose</u>
</div>
<input id="fileupload" type="file" multiple name="files">
<script src="./Scripts/filedrop.js"></script>

<div class="border2"></div>
<h2 style="text-align: center; font-size: 35px; color: #fff; text-shadow: 0 0 10px #ff00ff, 0 0 20px #ff00ff; font-family: 'Turret Road', sans-serif;">Monaco Editor</h2>
<div class="wrapeditor">
<div id="tabBar" class="tab-bar"></div>

<div id="editorContainer" class="editor-area"></div>
<div id="statusBar" class="status-bar">
    <div id="cursorPos">Ln 1, Col 1</div>
    <div id="indentInfo">Spaces: 4</div>
    <div id="encodingInfo">UTF-8</div>
    <div id="eolInfo">CRLF</div>
    <div id="langInfo">PLAINTEXT</div>
</div>
</div>
<div id="buttonBar" class="button-bar"></div>

<div class="border"></div>

<div class="card cyber-grid help-container">
    <div class="support-grid" style="display: grid; grid-template-columns: 1fr; gap: 15px; @media (min-width: 768px) { grid-template-columns: 1fr 1fr; }">
        <div style="grid-column: 1 / -1;">
            <p class="support-label" style="font-weight: bold; color: var(--neon-yellow); margin-bottom: 10px; margin-top: 15px;">SUPPORT THIS PROJECT!</p>
                <a href="https://www.buymeacoffee.com/_zkn"><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee!&emoji=‚òï&slug=_zkn&button_colour=ff00ff&font_colour=000000&font_family=Cookie&outline_colour=000000&coffee_colour=FFDD00" /></a>
        </div>
    </div>
</div>
	
<div class="footer-note">
    ‚ö†Ô∏è By using this tool, you agree to accept all kinds of risks.
</div>
<div style="text-align: center; margin: 30px 0 20px;">
    <a href="../" class="back-btn">‚¨ÖÔ∏è Back to Main Menu</a>
</div>
	
</div>
	
<div id="PreLoad" style="font-size: 50px; position: fixed; display: flex; z-index: 999999; padding: 270px 40px; font-weight: bold; font-family: 'Turret Road', sans-serif; inset: 0; transition: opacity 0.6s ease; backdrop-filter: blur(3px); justify-content: center; align-items: center; text-align: center; background-color: rgba(0, 0, 0, 0.6); color: white; display: none;">Loading...</div>
	
<script src="./bundles/custom.js"></script>
<script src="./bundles/script.js"></script>

<script>
		function getFormData($form){
			var unindexed_array = $form.serializeArray();
			var indexed_array = {};
			$.map(unindexed_array, function (n, i) {
				if (!(n['name'] in indexed_array))
					indexed_array[n['name']] = n['value'];
			});
			return indexed_array;
		}

		function PreLoadOn() {
			$('#PreLoad').show();
		}
		function PreLoadOff() {
			$('#PreLoad').hide();
		}
	
        document.addEventListener("keydown", e => {
	        if (
          	    e.key === "F12" ||
          	    (e.ctrlKey && e.shiftKey && ["I", "J", "C"].includes(e.key)) ||
         	    (e.ctrlKey && e.key === "U")
        	) {
         	    e.preventDefault();
        	}
       	});

       	console.log('%c‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ïó\n‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë\n‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë\n‚ñë‚ïö‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïù‚ñë‚ïö‚ïê‚ïù\n‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïó\n‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ñë‚ñë‚ñë‚ñë‚ïö‚ïê‚ïù‚ñë‚ñë‚ñë‚ñë‚ïö‚ïê‚ïê‚ïê‚ïê‚ïù‚ñë‚ïö‚ïê‚ïù‚ñë‚ñë‚ñë‚ñë‚ñë‚ïö‚ïê‚ïù', 'color: red; font-weight: bold;');
</script>

<script src="./bundles/index.js"></script>
<script src="./Scripts/particles.js"></script>

<script>
// =====================================
// CONFIG
// =====================================
	
const API_HOSTS = [
  "https://game-text-editor-api-production.up.railway.app",
  "https://game-text-editor-api-production-aeba.up.railway.app",
  "https://game-text-editor-api-production-7a01.up.railway.app",
  "https://game-text-backend.onrender.com",
  "https://game-text-editor.onrender.com",
  "https://game-text-editor-api-9grm.onrender.com",
  "https://game-text-backend-backup-u9d9.onrender.com",
  "https://game-text-backend.vercel.app",
  "https://game-text-editor.vercel.app",
  "https://game-text-editor-api.vercel.app",
  "https://game-text-backend-backup.vercel.app"
];

async function apiFetch(path, options) {
  for (let base of API_HOSTS) {
    try {
      const res = await fetch(base + path, options);
      if (res.ok) {
        console.log("Using API:", base);
        return res;
      }
    } catch (e) {
      console.warn("API failed:", base);
    }
  }
  throw new Error("‚ùå All backend servers failed!");
}

// =====================================
// LOAD EDITOR
// =====================================
	
async function loadEditor(id) {
    PreLoadOn();

    try {
        const res = await apiFetch("/Edit/" + id);

        if (!res.ok) {
            alert("Load editor error: " + res.status);
            PreLoadOff();
            return;
        }

        const json = await res.json();

        // Show editor
        $('#headM').show();
        $('#editorContainer').show();

        renderEditor(json);
    } catch (e) {
        console.error(e);
        alert("Editor load failed");
    }

    PreLoadOff();
}

// =====================================
// SAVE DATA
// =====================================
	
async function saveData(id) {
    let dataText = document.getElementById("editorArea").value;
    let json;

    try {
        json = JSON.parse(dataText);
    } catch (e) {
        alert("Invalid JSON!");
        return;
    }

    PreLoadOn();

    try {
        const res = await apiFetch("/Edit/" + id, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ data: json })
        });

        if (res.ok) {
            const blob = await res.blob();
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "edited.json";
            a.click();
            URL.revokeObjectURL(url);
        } else {
            alert("Save failed: " + res.status);
        }
    } catch (err) {
        console.error(err);
        alert("Save network error!");
    }

    PreLoadOff();
}
</script>

<script src="./Scripts/editor.js"></script>

</body>
	
</html>